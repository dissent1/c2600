<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>aMule: src/Proxy.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>src/Proxy.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// This file is part of the aMule Project.</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// Copyright (c) 2004-2011 aMule Team ( admin@amule.org / http://www.amule.org )</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (c) 2004-2011 Marcelo Roberto Jimenez ( phoenix@amule.org )</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// Any parts of this program derived from the xMule, lMule or eMule project,</span>
<a name="l00008"></a>00008 <span class="comment">// or contributed by third-party developers are copyrighted by their</span>
<a name="l00009"></a>00009 <span class="comment">// respective authors.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// This program is free software; you can redistribute it and/or modify</span>
<a name="l00012"></a>00012 <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l00013"></a>00013 <span class="comment">// the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00014"></a>00014 <span class="comment">// (at your option) any later version.</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// This program is distributed in the hope that it will be useful,</span>
<a name="l00017"></a>00017 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00018"></a>00018 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00019"></a>00019 <span class="comment">// GNU General Public License for more details.</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l00022"></a>00022 <span class="comment">// along with this program; if not, write to the Free Software</span>
<a name="l00023"></a>00023 <span class="comment">// Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301, USA</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#ifndef __PROXY_H__</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#define __PROXY_H__</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;wx/wx.h&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;amuleIPV4Address.h&quot;</span>   <span class="comment">// For amuleIPV4address</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;StateMachine.h&quot;</span>   <span class="comment">// For CStateMachine</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/******************************************************************************/</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">/*</span>
<a name="l00037"></a>00037 <span class="comment"> * SOCKS4 protocol implementation according to:</span>
<a name="l00038"></a>00038 <span class="comment"> * - &quot;SOCKS: A protocol for TCP proxy across firewalls&quot;:</span>
<a name="l00039"></a>00039 <span class="comment"> *   amule-root/docs/socks4.protocol</span>
<a name="l00040"></a>00040 <span class="comment"> */</span>
<a name="l00041"></a>00041 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_VERSION = 0x04;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_CMD_CONNECT  = 0x01;
<a name="l00044"></a>00044 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_CMD_BIND = 0x02;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_REPLY_CODE               = 0;
<a name="l00047"></a>00047 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_REPLY_GRANTED            = 90;
<a name="l00048"></a>00048 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_REPLY_FAILED             = 91;
<a name="l00049"></a>00049 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_REPLY_FAILED_NO_IDENTD       = 92;
<a name="l00050"></a>00050 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS4_REPLY_FAILED_DIFFERENT_USERIDS   = 93;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/*</span>
<a name="l00053"></a>00053 <span class="comment"> * SOCKS5 protocol implementation according to:</span>
<a name="l00054"></a>00054 <span class="comment"> * - RFC-1928: SOCKS Protocol Version 5</span>
<a name="l00055"></a>00055 <span class="comment"> * - RFC-1929: username/password Authentication for SOCKS V5</span>
<a name="l00056"></a>00056 <span class="comment"> *</span>
<a name="l00057"></a>00057 <span class="comment"> * Also, for the future :) :</span>
<a name="l00058"></a>00058 <span class="comment"> * - RFC-1961: GSS-API Authentication Method for SOCKS Version 5</span>
<a name="l00059"></a>00059 <span class="comment"> * - RFC-1508: Generic Security Service Application Program Interface</span>
<a name="l00060"></a>00060 <span class="comment"> * - RFC-1509: Genecic Security Service API: C-bindings</span>
<a name="l00061"></a>00061 <span class="comment"> *   </span>
<a name="l00062"></a>00062 <span class="comment"> */</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_VERSION = 0x05;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_AUTH_METHOD_NO_AUTH_REQUIRED     = 0x00;
<a name="l00067"></a>00067 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_AUTH_METHOD_GSSAPI           = 0x01;
<a name="l00068"></a>00068 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_AUTH_METHOD_USERNAME_PASSWORD    = 0x02;
<a name="l00069"></a>00069 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_AUTH_METHOD_NO_ACCEPTABLE_METHODS    = 0xFF;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_AUTH_VERSION_USERNAME_PASSWORD   = 0x01;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_CMD_CONNECT      = 0x01;
<a name="l00074"></a>00074 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_CMD_BIND     = 0x02;
<a name="l00075"></a>00075 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_CMD_UDP_ASSOCIATE    = 0x03;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_RSV = 0x00;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_ATYP_IPV4_ADDRESS    = 0x01;
<a name="l00080"></a>00080 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_ATYP_DOMAINNAME  = 0x03;
<a name="l00081"></a>00081 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_ATYP_IPV6_ADDRESS    = 0x04;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_SUCCEED        = 0x00;
<a name="l00084"></a>00084 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_GENERAL_SERVER_FAILURE = 0x01;
<a name="l00085"></a>00085 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_CONNECTION_NOT_ALLOWED = 0x02;
<a name="l00086"></a>00086 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_NETWORK_UNREACHABLE    = 0x03;
<a name="l00087"></a>00087 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_HOST_UNREACHABLE   = 0x04;
<a name="l00088"></a>00088 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_CONNECTION_REFUSED = 0x05;
<a name="l00089"></a>00089 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_TTL_EXPIRED        = 0x06;
<a name="l00090"></a>00090 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_COMMAND_NOT_SUPPORTED  = 0x07;
<a name="l00091"></a>00091 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SOCKS5_REPLY_ATYP_NOT_SUPPORTED = 0x08;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00094"></a>00094 <span class="comment">// CProxyType</span>
<a name="l00095"></a>00095 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">/*</span>
<a name="l00098"></a>00098 <span class="comment"> * These constants must match the integer values saved in the configuration file,</span>
<a name="l00099"></a>00099 <span class="comment"> * DO NOT CHANGE THIS ORDER!!!</span>
<a name="l00100"></a>00100 <span class="comment"> */</span>
<a name="l00101"></a>00101 <span class="keyword">enum</span> CProxyType {
<a name="l00102"></a>00102     PROXY_NONE = -1,
<a name="l00103"></a>00103     PROXY_SOCKS5,
<a name="l00104"></a>00104     PROXY_SOCKS4,
<a name="l00105"></a>00105     PROXY_HTTP,
<a name="l00106"></a>00106     PROXY_SOCKS4a
<a name="l00107"></a>00107 };
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00111"></a>00111 <span class="comment">// CProxyData</span>
<a name="l00112"></a>00112 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00116"></a><a class="code" href="classCProxyData.html">00116</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a>
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118 <span class="keyword">public</span>:
<a name="l00122"></a>00122     <a class="code" href="classCProxyData.html#af68baf69fbde529f8bc97dccda81f3cb" title="Default constructor.">CProxyData</a>();
<a name="l00134"></a>00134     <a class="code" href="classCProxyData.html#af68baf69fbde529f8bc97dccda81f3cb" title="Default constructor.">CProxyData</a>(
<a name="l00135"></a>00135         <span class="keywordtype">bool</span>        proxyEnable,
<a name="l00136"></a>00136         CProxyType  proxyType,
<a name="l00137"></a>00137         <span class="keyword">const</span> wxString  &amp;proxyHostName,
<a name="l00138"></a>00138         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>  proxyPort,
<a name="l00139"></a>00139         <span class="keywordtype">bool</span>        enablePassword,
<a name="l00140"></a>00140         <span class="keyword">const</span> wxString  &amp;userName,
<a name="l00141"></a>00141         <span class="keyword">const</span> wxString  &amp;password
<a name="l00142"></a>00142     );
<a name="l00146"></a>00146     <span class="keywordtype">void</span> <a class="code" href="classCProxyData.html#a87a257656faec7afbbb1c0beb29b3566" title="Clears the object contents.">Clear</a>();
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="keyword">public</span>:
<a name="l00150"></a><a class="code" href="classCProxyData.html#a98f403be733907f0747dcfed8658e8ec">00150</a>     <span class="keywordtype">bool</span>        <a class="code" href="classCProxyData.html#a98f403be733907f0747dcfed8658e8ec" title="Whether proxy is enabled or not.">m_proxyEnable</a>;
<a name="l00152"></a><a class="code" href="classCProxyData.html#a319af7e3463971207d3e528ce3639288">00152</a>     CProxyType  <a class="code" href="classCProxyData.html#a319af7e3463971207d3e528ce3639288" title="The type of the proxy server.">m_proxyType</a>;
<a name="l00154"></a><a class="code" href="classCProxyData.html#a77f11bf8aef5c06298a3329725b62f89">00154</a>     wxString    <a class="code" href="classCProxyData.html#a77f11bf8aef5c06298a3329725b62f89" title="The proxy host name or IP address.">m_proxyHostName</a>;
<a name="l00156"></a><a class="code" href="classCProxyData.html#adf3a0c857c343c69fec7276ef9bf40c7">00156</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>  <a class="code" href="classCProxyData.html#adf3a0c857c343c69fec7276ef9bf40c7" title="The proxy port number.">m_proxyPort</a>;
<a name="l00158"></a><a class="code" href="classCProxyData.html#ad8d2644bc1b6f9ecb55551519dea2cd6">00158</a>     <span class="keywordtype">bool</span>        <a class="code" href="classCProxyData.html#ad8d2644bc1b6f9ecb55551519dea2cd6" title="Whether authentication should be performed.">m_enablePassword</a>;
<a name="l00160"></a><a class="code" href="classCProxyData.html#ae33db15612ca168be370b741b1ea6e0c">00160</a>     wxString    <a class="code" href="classCProxyData.html#ae33db15612ca168be370b741b1ea6e0c" title="The user name to authenticate to the server.">m_userName</a>;
<a name="l00162"></a><a class="code" href="classCProxyData.html#af1b6eac818d96a3ace65cf254f19a437">00162</a>     wxString    <a class="code" href="classCProxyData.html#af1b6eac818d96a3ace65cf254f19a437" title="The password to authenticate to the server.">m_password</a>;
<a name="l00163"></a>00163 };
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00166"></a>00166 <span class="comment">// CProxyEventHandler</span>
<a name="l00167"></a>00167 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00171"></a><a class="code" href="classCProxyEventHandler.html">00171</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classCProxyEventHandler.html" title="Event handler object used during proxy negotiation.">CProxyEventHandler</a> : <span class="keyword">public</span> wxEvtHandler {
<a name="l00172"></a>00172 <span class="keyword">public</span>:
<a name="l00176"></a>00176     <a class="code" href="classCProxyEventHandler.html#af8d8c8ea08bf372030ae6c19d00946c6" title="Constructor.">CProxyEventHandler</a>();
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="keyword">private</span>:
<a name="l00182"></a>00182     <span class="keywordtype">void</span> <a class="code" href="classCProxyEventHandler.html#a4e988ddc415bb63f6ce03189c7476cc9" title="Event handler function.">ProxySocketHandler</a>(wxSocketEvent &amp;event);
<a name="l00183"></a>00183     DECLARE_EVENT_TABLE()
<a name="l00184"></a>00184 };
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00187"></a>00187 <span class="comment">// CProxyStateMachine</span>
<a name="l00188"></a>00188 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00189"></a>00189 <span class="comment">/* This size is just to be a little bit greater than the UDP buffer used in aMule.</span>
<a name="l00190"></a>00190 <span class="comment"> * Proxy protocol needs much less than this. 1024 would be ok. Other options are</span>
<a name="l00191"></a>00191 <span class="comment"> * - Default ethernet MTU - Eth-II - IP - UDP: 1,514 - 14 - 20 - 8 = 1472 bytes;</span>
<a name="l00192"></a>00192 <span class="comment"> * - Default token ring MTU 4,202 - overheads = ??.</span>
<a name="l00193"></a>00193 <span class="comment"> * It would be really more efficient if the final object was less than </span>
<a name="l00194"></a>00194 <span class="comment"> * a page (4096 bytes) in size.</span>
<a name="l00195"></a>00195 <span class="comment"> */</span>
<a name="l00196"></a>00196 <span class="comment">//const unsigned int PROXY_BUFFER_SIZE = 1024;</span>
<a name="l00197"></a>00197 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PROXY_BUFFER_SIZE = 5*1024;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="keyword">enum</span> CProxyCommand {
<a name="l00200"></a>00200     PROXY_CMD_CONNECT,
<a name="l00201"></a>00201     PROXY_CMD_BIND,
<a name="l00202"></a>00202     PROXY_CMD_UDP_ASSOCIATE
<a name="l00203"></a>00203 };
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="keyword">enum</span> CProxyState {
<a name="l00206"></a>00206     PROXY_STATE_START = 0,
<a name="l00207"></a>00207     PROXY_STATE_END = 1
<a name="l00208"></a>00208 };
<a name="l00209"></a>00209 
<a name="l00216"></a><a class="code" href="classCProxyStateMachine.html">00216</a> <span class="keyword">class </span><a class="code" href="classCProxyStateMachine.html" title="The ProxyStateMachine class is the ancestor of all proxy classes.">CProxyStateMachine</a> : <span class="keyword">public</span> <a class="code" href="classCStateMachine.html">CStateMachine</a>
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218 <span class="keyword">public</span>:
<a name="l00227"></a>00227     <a class="code" href="classCProxyStateMachine.html#a6fd1038a4f457e3e91bbab5919ff7c82" title="Constructor.">CProxyStateMachine</a>(
<a name="l00228"></a>00228         wxString name,
<a name="l00229"></a>00229         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_states,
<a name="l00230"></a>00230         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> &amp;proxyData,
<a name="l00231"></a>00231         CProxyCommand cmd);
<a name="l00235"></a>00235     <span class="keyword">virtual</span> <a class="code" href="classCProxyStateMachine.html#a908db34d47f857937e4a7817b3655241" title="Destructor.">~CProxyStateMachine</a>();
<a name="l00242"></a>00242     <span class="keyword">static</span> wxString &amp;<a class="code" href="classCProxyStateMachine.html#af6189b24a6d9320c5327b377af19f473" title="Adds a small string to the state machine name, containing the proxy command.">NewName</a>(wxString &amp;s, CProxyCommand cmd);
<a name="l00243"></a>00243     
<a name="l00244"></a>00244     <span class="comment">/* Interface */</span>
<a name="l00245"></a>00245     <span class="keywordtype">bool</span>        Start(<span class="keyword">const</span> wxIPaddress &amp;peerAddress, wxSocketClient *proxyClientSocket);
<a name="l00246"></a>00246     t_sm_state  HandleEvent(t_sm_event event);
<a name="l00247"></a>00247     <span class="keywordtype">void</span>        AddDummyEvent();
<a name="l00248"></a>00248     <span class="keywordtype">void</span>        ReactivateSocket();
<a name="l00249"></a>00249     <span class="keywordtype">char</span>        *GetBuffer()                { <span class="keywordflow">return</span> m_buffer; }
<a name="l00250"></a>00250     wxIPaddress &amp;GetProxyBoundAddress(<span class="keywordtype">void</span>)<span class="keyword"> const   </span>{ <span class="keywordflow">return</span> *m_proxyBoundAddress; }
<a name="l00251"></a>00251     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   GetLastReply(<span class="keywordtype">void</span>)<span class="keyword"> const        </span>{ <span class="keywordflow">return</span> m_lastReply; }
<a name="l00252"></a>00252     <span class="keywordtype">bool</span>        IsEndState()<span class="keyword"> const          </span>{ <span class="keywordflow">return</span> GetState() == PROXY_STATE_END; }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="keyword">protected</span>:
<a name="l00255"></a>00255     wxSocketBase        &amp;ProxyWrite(wxSocketBase &amp;socket, <span class="keyword">const</span> <span class="keywordtype">void</span> *buffer, wxUint32 nbytes);
<a name="l00256"></a>00256     wxSocketBase        &amp;ProxyRead(wxSocketBase &amp;socket, <span class="keywordtype">void</span> *buffer);
<a name="l00257"></a>00257     <span class="keywordtype">bool</span>        CanReceive() <span class="keyword">const</span>;
<a name="l00258"></a>00258     <span class="keywordtype">bool</span>        CanSend() <span class="keyword">const</span>;
<a name="l00259"></a>00259     <span class="comment">//</span>
<a name="l00260"></a>00260     <span class="comment">// Initialized at constructor</span>
<a name="l00261"></a>00261     <span class="comment">//</span>
<a name="l00262"></a>00262     <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a>    &amp;m_proxyData;
<a name="l00263"></a>00263     CProxyCommand       m_proxyCommand;
<a name="l00264"></a>00264     <span class="comment">//</span>
<a name="l00265"></a>00265     <span class="comment">// Member variables</span>
<a name="l00266"></a>00266     <span class="comment">//</span>
<a name="l00267"></a>00267     <span class="keywordtype">char</span>            m_buffer[PROXY_BUFFER_SIZE];
<a name="l00268"></a>00268     <span class="keywordtype">bool</span>            m_isLost;
<a name="l00269"></a>00269     <span class="keywordtype">bool</span>            m_isConnected;
<a name="l00270"></a>00270     <span class="keywordtype">bool</span>            m_canReceive;
<a name="l00271"></a>00271     <span class="keywordtype">bool</span>            m_canSend;
<a name="l00272"></a>00272     <span class="keywordtype">bool</span>            m_ok;
<a name="l00273"></a>00273     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_lastRead;
<a name="l00274"></a>00274     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_lastWritten;
<a name="l00275"></a>00275     wxSocketError       m_lastError;
<a name="l00276"></a>00276     <span class="comment">//</span>
<a name="l00277"></a>00277     <span class="comment">// Will be initialized at Start()</span>
<a name="l00278"></a>00278     <span class="comment">//</span>
<a name="l00279"></a>00279     wxIPaddress     *m_peerAddress;
<a name="l00280"></a>00280     wxSocketClient      *m_proxyClientSocket;   
<a name="l00281"></a>00281     wxIPaddress     *m_proxyBoundAddress;
<a name="l00282"></a>00282     <a class="code" href="classamuleIPV4Address.html">amuleIPV4Address</a>    m_proxyBoundAddressIPV4;
<a name="l00283"></a>00283     <span class="comment">//wxIPV6address     m_proxyBoundAddressIPV6;</span>
<a name="l00284"></a>00284     <span class="comment">//</span>
<a name="l00285"></a>00285     <span class="comment">// Temporary variables</span>
<a name="l00286"></a>00286     <span class="comment">//</span>
<a name="l00287"></a>00287     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>       m_lastReply;
<a name="l00288"></a>00288     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_packetLenght;
<a name="l00289"></a>00289 };
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00292"></a>00292 <span class="comment">// CSocks5StateMachine</span>
<a name="l00293"></a>00293 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00294"></a>00294 <span class="keyword">class </span><a class="code" href="classCSocks5StateMachine.html">CSocks5StateMachine</a>;
<a name="l00295"></a>00295 <span class="keyword">typedef</span> void (<a class="code" href="classCSocks5StateMachine.html">CSocks5StateMachine</a>::*Socks5StateProcessor)(<span class="keywordtype">bool</span> entry);
<a name="l00296"></a><a class="code" href="classCSocks5StateMachine.html">00296</a> <span class="keyword">class </span><a class="code" href="classCSocks5StateMachine.html">CSocks5StateMachine</a> : <span class="keyword">public</span> <a class="code" href="classCProxyStateMachine.html" title="The ProxyStateMachine class is the ancestor of all proxy classes.">CProxyStateMachine</a>
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298 <span class="keyword">private</span>:
<a name="l00299"></a>00299     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> SOCKS5_MAX_STATES = 14;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keyword">enum</span> Socks5State {
<a name="l00302"></a>00302         SOCKS5_STATE_START = PROXY_STATE_START,
<a name="l00303"></a>00303         SOCKS5_STATE_END = PROXY_STATE_END,
<a name="l00304"></a>00304         SOCKS5_STATE_SEND_QUERY_AUTHENTICATION_METHOD,
<a name="l00305"></a>00305         SOCKS5_STATE_RECEIVE_AUTHENTICATION_METHOD,
<a name="l00306"></a>00306         SOCKS5_STATE_PROCESS_AUTHENTICATION_METHOD,
<a name="l00307"></a>00307         SOCKS5_STATE_SEND_AUTHENTICATION_GSSAPI,
<a name="l00308"></a>00308         SOCKS5_STATE_RECEIVE_AUTHENTICATION_GSSAPI,
<a name="l00309"></a>00309         SOCKS5_STATE_PROCESS_AUTHENTICATION_GSSAPI,
<a name="l00310"></a>00310         SOCKS5_STATE_SEND_AUTHENTICATION_USERNAME_PASSWORD,
<a name="l00311"></a>00311         SOCKS5_STATE_RECEIVE_AUTHENTICATION_USERNAME_PASSWORD,
<a name="l00312"></a>00312         SOCKS5_STATE_PROCESS_AUTHENTICATION_USERNAME_PASSWORD,
<a name="l00313"></a>00313         SOCKS5_STATE_SEND_COMMAND_REQUEST,
<a name="l00314"></a>00314         SOCKS5_STATE_RECEIVE_COMMAND_REPLY,
<a name="l00315"></a>00315         SOCKS5_STATE_PROCESS_COMMAND_REPLY
<a name="l00316"></a>00316     };
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="keyword">public</span>:
<a name="l00319"></a>00319     <span class="comment">/* Constructor */</span>
<a name="l00320"></a>00320     <a class="code" href="classCSocks5StateMachine.html#a55fe2b069f653977fc183a2c044c7878" title="The state machine constructor must initialize the array of pointer to member functions...">CSocks5StateMachine</a>(
<a name="l00321"></a>00321         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> &amp;proxyData,
<a name="l00322"></a>00322         CProxyCommand proxyCommand);
<a name="l00323"></a>00323     <span class="keywordtype">void</span> process_state(t_sm_state state, <span class="keywordtype">bool</span> entry);
<a name="l00324"></a>00324     t_sm_state <a class="code" href="classCSocks5StateMachine.html#afe61fed0178f3b70fd950b32b37b4e5f" title="Code this such that the next state is only entered when it is able to perform the...">next_state</a>(t_sm_event event);
<a name="l00325"></a>00325     
<a name="l00326"></a>00326 <span class="keyword">private</span>:
<a name="l00327"></a>00327     <span class="comment">/* State Processors */</span>
<a name="l00328"></a>00328     <span class="keywordtype">void</span> <a class="code" href="classCSocks5StateMachine.html#acdd81d50aaad7e67c448671548c46532" title="So, this is how you do it: the state machine is clocked by the events that happen...">process_start</a>(<span class="keywordtype">bool</span> entry);
<a name="l00329"></a>00329     <span class="keywordtype">void</span> process_send_query_authentication_method(<span class="keywordtype">bool</span> entry);
<a name="l00330"></a>00330     <span class="keywordtype">void</span> process_receive_authentication_method(<span class="keywordtype">bool</span> entry);
<a name="l00331"></a>00331     <span class="keywordtype">void</span> process_process_authentication_method(<span class="keywordtype">bool</span> entry);
<a name="l00332"></a>00332     <span class="keywordtype">void</span> process_send_authentication_gssapi(<span class="keywordtype">bool</span> entry);
<a name="l00333"></a>00333     <span class="keywordtype">void</span> process_receive_authentication_gssapi(<span class="keywordtype">bool</span> entry);
<a name="l00334"></a>00334     <span class="keywordtype">void</span> process_process_authentication_gssapi(<span class="keywordtype">bool</span> entry);
<a name="l00335"></a>00335     <span class="keywordtype">void</span> process_send_authentication_username_password(<span class="keywordtype">bool</span> entry);
<a name="l00336"></a>00336     <span class="keywordtype">void</span> process_receive_authentication_username_password(<span class="keywordtype">bool</span> entry);
<a name="l00337"></a>00337     <span class="keywordtype">void</span> process_process_authentication_username_password(<span class="keywordtype">bool</span> entry);
<a name="l00338"></a>00338     <span class="keywordtype">void</span> process_send_command_request(<span class="keywordtype">bool</span> entry);
<a name="l00339"></a>00339     <span class="keywordtype">void</span> process_receive_command_reply(<span class="keywordtype">bool</span> entry);
<a name="l00340"></a>00340     <span class="keywordtype">void</span> process_process_command_reply(<span class="keywordtype">bool</span> entry);
<a name="l00341"></a>00341     <span class="keywordtype">void</span> process_end(<span class="keywordtype">bool</span> entry);
<a name="l00342"></a>00342     <span class="comment">/* Private Vars */</span>
<a name="l00343"></a>00343     Socks5StateProcessor m_process_state[SOCKS5_MAX_STATES];
<a name="l00344"></a>00344     wxString m_state_name[SOCKS5_MAX_STATES];
<a name="l00345"></a>00345 };
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00348"></a>00348 <span class="comment">// CSocks4StateMachine</span>
<a name="l00349"></a>00349 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00350"></a>00350 <span class="keyword">class </span><a class="code" href="classCSocks4StateMachine.html">CSocks4StateMachine</a>;
<a name="l00351"></a>00351 <span class="keyword">typedef</span> void (<a class="code" href="classCSocks4StateMachine.html">CSocks4StateMachine</a>::*Socks4StateProcessor)(<span class="keywordtype">bool</span> entry);
<a name="l00352"></a><a class="code" href="classCSocks4StateMachine.html">00352</a> <span class="keyword">class </span><a class="code" href="classCSocks4StateMachine.html">CSocks4StateMachine</a> : <span class="keyword">public</span> <a class="code" href="classCProxyStateMachine.html" title="The ProxyStateMachine class is the ancestor of all proxy classes.">CProxyStateMachine</a>
<a name="l00353"></a>00353 {
<a name="l00354"></a>00354 <span class="keyword">private</span>:
<a name="l00355"></a>00355     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> SOCKS4_MAX_STATES = 5;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="keyword">enum</span> Socks4State {
<a name="l00358"></a>00358         SOCKS4_STATE_START = PROXY_STATE_START,
<a name="l00359"></a>00359         SOCKS4_STATE_END = PROXY_STATE_END,
<a name="l00360"></a>00360         SOCKS4_STATE_SEND_COMMAND_REQUEST,
<a name="l00361"></a>00361         SOCKS4_STATE_RECEIVE_COMMAND_REPLY,
<a name="l00362"></a>00362         SOCKS4_STATE_PROCESS_COMMAND_REPLY
<a name="l00363"></a>00363     };
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="keyword">public</span>:
<a name="l00366"></a>00366     <span class="comment">/* Constructor */</span>
<a name="l00367"></a>00367     <a class="code" href="classCSocks4StateMachine.html">CSocks4StateMachine</a>(
<a name="l00368"></a>00368         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> &amp;proxyData,
<a name="l00369"></a>00369         CProxyCommand proxyCommand);
<a name="l00370"></a>00370     <span class="keywordtype">void</span> process_state(t_sm_state state, <span class="keywordtype">bool</span> entry);
<a name="l00371"></a>00371     t_sm_state next_state(t_sm_event event);
<a name="l00372"></a>00372     
<a name="l00373"></a>00373 <span class="keyword">private</span>:
<a name="l00374"></a>00374     <span class="comment">/* State Processors */</span>
<a name="l00375"></a>00375     <span class="keywordtype">void</span> process_start(<span class="keywordtype">bool</span> entry);
<a name="l00376"></a>00376     <span class="keywordtype">void</span> process_send_command_request(<span class="keywordtype">bool</span> entry);
<a name="l00377"></a>00377     <span class="keywordtype">void</span> process_receive_command_reply(<span class="keywordtype">bool</span> entry);
<a name="l00378"></a>00378     <span class="keywordtype">void</span> process_process_command_reply(<span class="keywordtype">bool</span> entry);
<a name="l00379"></a>00379     <span class="keywordtype">void</span> process_end(<span class="keywordtype">bool</span> entry);
<a name="l00380"></a>00380     <span class="comment">/* Private Vars */</span>
<a name="l00381"></a>00381     Socks4StateProcessor m_process_state[SOCKS4_MAX_STATES];
<a name="l00382"></a>00382     wxString m_state_name[SOCKS4_MAX_STATES];
<a name="l00383"></a>00383 };
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00386"></a>00386 <span class="comment">// CHttpStateMachine</span>
<a name="l00387"></a>00387 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00388"></a>00388 <span class="keyword">class </span><a class="code" href="classCHttpStateMachine.html">CHttpStateMachine</a>;
<a name="l00389"></a>00389 <span class="keyword">typedef</span> void (<a class="code" href="classCHttpStateMachine.html">CHttpStateMachine</a>::*HttpStateProcessor)(<span class="keywordtype">bool</span> entry);
<a name="l00390"></a><a class="code" href="classCHttpStateMachine.html">00390</a> <span class="keyword">class </span><a class="code" href="classCHttpStateMachine.html">CHttpStateMachine</a> : <span class="keyword">public</span> <a class="code" href="classCProxyStateMachine.html" title="The ProxyStateMachine class is the ancestor of all proxy classes.">CProxyStateMachine</a>
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392 <span class="keyword">private</span>:
<a name="l00393"></a>00393     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> HTTP_MAX_STATES = 5;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keyword">enum</span> HttpState {
<a name="l00396"></a>00396         HTTP_STATE_START = PROXY_STATE_START,
<a name="l00397"></a>00397         HTTP_STATE_END = PROXY_STATE_END,
<a name="l00398"></a>00398         HTTP_STATE_SEND_COMMAND_REQUEST,
<a name="l00399"></a>00399         HTTP_STATE_RECEIVE_COMMAND_REPLY,
<a name="l00400"></a>00400         HTTP_STATE_PROCESS_COMMAND_REPLY
<a name="l00401"></a>00401     };
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 <span class="keyword">public</span>:
<a name="l00404"></a>00404     <span class="comment">/* Constructor */</span>
<a name="l00405"></a>00405     <a class="code" href="classCHttpStateMachine.html">CHttpStateMachine</a>(
<a name="l00406"></a>00406         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> &amp;proxyData,
<a name="l00407"></a>00407         CProxyCommand proxyCommand);
<a name="l00408"></a>00408     <span class="keywordtype">void</span> process_state(t_sm_state state, <span class="keywordtype">bool</span> entry);
<a name="l00409"></a>00409     t_sm_state next_state(t_sm_event event);
<a name="l00410"></a>00410     
<a name="l00411"></a>00411 <span class="keyword">private</span>:
<a name="l00412"></a>00412     <span class="comment">/* State Processors */</span>
<a name="l00413"></a>00413     <span class="keywordtype">void</span> process_start(<span class="keywordtype">bool</span> entry);
<a name="l00414"></a>00414     <span class="keywordtype">void</span> process_send_command_request(<span class="keywordtype">bool</span> entry);
<a name="l00415"></a>00415     <span class="keywordtype">void</span> process_receive_command_reply(<span class="keywordtype">bool</span> entry);
<a name="l00416"></a>00416     <span class="keywordtype">void</span> process_process_command_reply(<span class="keywordtype">bool</span> entry);
<a name="l00417"></a>00417     <span class="keywordtype">void</span> process_end(<span class="keywordtype">bool</span> entry);
<a name="l00418"></a>00418     <span class="comment">/* Private Vars */</span>
<a name="l00419"></a>00419     HttpStateProcessor m_process_state[HTTP_MAX_STATES];
<a name="l00420"></a>00420     wxString m_state_name[HTTP_MAX_STATES];
<a name="l00421"></a>00421 };
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00424"></a>00424 <span class="comment">// CProxySocket</span>
<a name="l00425"></a>00425 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 <span class="keyword">class </span><a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a>;
<a name="l00428"></a>00428 
<a name="l00429"></a><a class="code" href="classCProxySocket.html">00429</a> <span class="keyword">class </span><a class="code" href="classCProxySocket.html">CProxySocket</a> : <span class="keyword">public</span> wxSocketClient
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431 <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCProxyEventHandler.html" title="Event handler object used during proxy negotiation.">CProxyEventHandler</a>;
<a name="l00432"></a>00432 <span class="keyword">public</span>:
<a name="l00433"></a>00433     <span class="comment">/* Constructor */</span>
<a name="l00434"></a>00434     <a class="code" href="classCProxySocket.html">CProxySocket</a>(
<a name="l00435"></a>00435         wxSocketFlags flags = wxSOCKET_NONE,
<a name="l00436"></a>00436         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> *proxyData = NULL,
<a name="l00437"></a>00437         CProxyCommand proxyCommand = PROXY_CMD_CONNECT,
<a name="l00438"></a>00438         <a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a> *udpSocket = NULL);
<a name="l00439"></a>00439     
<a name="l00440"></a>00440     <span class="comment">/* Destructor */</span>
<a name="l00441"></a>00441     ~<a class="code" href="classCProxySocket.html">CProxySocket</a>();
<a name="l00442"></a>00442     
<a name="l00443"></a>00443     <span class="comment">/* I know, this is not very good, because SetEventHandler is not</span>
<a name="l00444"></a>00444 <span class="comment">     * virtual in wxSocketBase, but I need to GetEventHandler in Proxy.cpp,</span>
<a name="l00445"></a>00445 <span class="comment">     * so...</span>
<a name="l00446"></a>00446 <span class="comment">     */</span>
<a name="l00447"></a>00447     <span class="keywordtype">void</span> SetEventHandler(wxEvtHandler &amp;handler, <span class="keywordtype">int</span> <span class="keywordtype">id</span> = wxID_ANY)
<a name="l00448"></a>00448     {
<a name="l00449"></a>00449         m_socketEventHandler = &amp;handler;
<a name="l00450"></a>00450         m_socketEventHandlerId = id;
<a name="l00451"></a>00451         wxSocketClient::SetEventHandler(handler, <span class="keywordtype">id</span>);
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453     wxEvtHandler *GetEventHandler(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_socketEventHandler; }
<a name="l00454"></a>00454     <span class="keywordtype">int</span> GetEventHandlerId(<span class="keywordtype">void</span>)<span class="keyword">     const </span>{ <span class="keywordflow">return</span> m_socketEventHandlerId; }
<a name="l00455"></a>00455     <span class="keywordtype">void</span> SaveEventHandler(<span class="keywordtype">void</span>)
<a name="l00456"></a>00456     {
<a name="l00457"></a>00457         m_savedSocketEventHandler = m_socketEventHandler;
<a name="l00458"></a>00458         m_savedSocketEventHandlerId = m_socketEventHandlerId;
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460     <span class="keywordtype">void</span> RestoreEventHandler(<span class="keywordtype">void</span>)
<a name="l00461"></a>00461     {
<a name="l00462"></a>00462         m_socketEventHandler = m_savedSocketEventHandler;
<a name="l00463"></a>00463         m_socketEventHandlerId = m_savedSocketEventHandlerId;
<a name="l00464"></a>00464         SetEventHandler(*m_socketEventHandler, m_socketEventHandlerId);
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466     
<a name="l00467"></a>00467     <span class="comment">/* Interface */</span>
<a name="l00468"></a>00468     <span class="keywordtype">void</span>        SetProxyData(<span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> *proxyData);
<a name="l00469"></a>00469     <span class="keywordtype">bool</span>        GetUseProxy()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_useProxy; }
<a name="l00470"></a>00470     <span class="keywordtype">char</span>        *GetBuffer()        { <span class="keywordflow">return</span> m_proxyStateMachine-&gt;GetBuffer(); }
<a name="l00471"></a>00471     wxIPaddress &amp;GetProxyBoundAddress(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00472"></a>00472 <span class="keyword">                        </span>{ <span class="keywordflow">return</span> m_proxyStateMachine-&gt;GetProxyBoundAddress(); }
<a name="l00473"></a>00473     <span class="keywordtype">bool</span> Start(<span class="keyword">const</span> wxIPaddress &amp;peerAddress);
<a name="l00474"></a>00474     <span class="keywordtype">bool</span> ProxyIsCapableOf(CProxyCommand proxyCommand) <span class="keyword">const</span>;
<a name="l00475"></a>00475     <span class="keywordtype">bool</span> ProxyNegotiationIsOver()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_proxyStateMachine-&gt;IsEndState(); }
<a name="l00476"></a>00476     <a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a> *GetUDPSocket()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_udpSocket; }
<a name="l00477"></a>00477     
<a name="l00478"></a>00478 <span class="keyword">private</span>:
<a name="l00479"></a>00479     <span class="keywordtype">bool</span>            m_useProxy;
<a name="l00480"></a>00480     <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a>      m_proxyData;
<a name="l00481"></a>00481     <a class="code" href="classamuleIPV4Address.html">amuleIPV4Address</a>    m_proxyAddress;
<a name="l00482"></a>00482     <a class="code" href="classCProxyStateMachine.html" title="The ProxyStateMachine class is the ancestor of all proxy classes.">CProxyStateMachine</a>  *m_proxyStateMachine;
<a name="l00483"></a>00483     <a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a>    *m_udpSocket;
<a name="l00484"></a>00484     wxEvtHandler        *m_socketEventHandler;
<a name="l00485"></a>00485     <span class="keywordtype">int</span>         m_socketEventHandlerId;
<a name="l00486"></a>00486     wxEvtHandler        *m_savedSocketEventHandler;
<a name="l00487"></a>00487     <span class="keywordtype">int</span>         m_savedSocketEventHandlerId;
<a name="l00488"></a>00488 };
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00491"></a>00491 <span class="comment">// CSocketClientProxy</span>
<a name="l00492"></a>00492 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="classCSocketClientProxy.html">00494</a> <span class="keyword">class </span><a class="code" href="classCSocketClientProxy.html">CSocketClientProxy</a> : <span class="keyword">public</span> <a class="code" href="classCProxySocket.html">CProxySocket</a>
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496 <span class="keyword">public</span>:
<a name="l00497"></a>00497     <span class="comment">/* Constructor */</span>
<a name="l00498"></a>00498     <a class="code" href="classCSocketClientProxy.html">CSocketClientProxy</a>(
<a name="l00499"></a>00499         wxSocketFlags flags = wxSOCKET_NONE,
<a name="l00500"></a>00500         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> *proxyData = NULL);
<a name="l00501"></a>00501         
<a name="l00502"></a>00502     <span class="comment">/* Interface */</span>
<a name="l00503"></a>00503     <span class="keywordtype">bool</span> Connect(wxIPaddress &amp;address, <span class="keywordtype">bool</span> wait);
<a name="l00504"></a>00504     <a class="code" href="classCSocketClientProxy.html">CSocketClientProxy</a>&amp; Read(<span class="keywordtype">void</span> *buffer, wxUint32 nbytes);
<a name="l00505"></a>00505     <a class="code" href="classCSocketClientProxy.html">CSocketClientProxy</a>&amp; Write(<span class="keyword">const</span> <span class="keywordtype">void</span> *buffer, wxUint32 nbytes);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="keyword">private</span>:
<a name="l00508"></a>00508     wxMutex         m_socketLocker;
<a name="l00509"></a>00509 };
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00512"></a>00512 <span class="comment">// CSocketServerProxy</span>
<a name="l00513"></a>00513 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="classCSocketServerProxy.html">00515</a> <span class="keyword">class </span><a class="code" href="classCSocketServerProxy.html">CSocketServerProxy</a> : <span class="keyword">public</span> wxSocketServer
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517 <span class="keyword">public</span>:
<a name="l00518"></a>00518     <span class="comment">/* Constructor */</span>
<a name="l00519"></a>00519     <a class="code" href="classCSocketServerProxy.html">CSocketServerProxy</a>(
<a name="l00520"></a>00520         wxIPaddress &amp;address,
<a name="l00521"></a>00521         wxSocketFlags flags = wxSOCKET_NONE,
<a name="l00522"></a>00522         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> *proxyData = NULL);
<a name="l00523"></a>00523         
<a name="l00524"></a>00524     <span class="comment">/* Interface */</span>
<a name="l00525"></a>00525     <a class="code" href="classCSocketServerProxy.html">CSocketServerProxy</a>&amp; Read(<span class="keywordtype">void</span> *buffer, wxUint32 nbytes);
<a name="l00526"></a>00526     <a class="code" href="classCSocketServerProxy.html">CSocketServerProxy</a>&amp; Write(<span class="keyword">const</span> <span class="keywordtype">void</span> *buffer, wxUint32 nbytes);
<a name="l00527"></a>00527     
<a name="l00528"></a>00528 <span class="keyword">private</span>:
<a name="l00529"></a>00529     wxMutex         m_socketLocker;
<a name="l00530"></a>00530 };
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00533"></a>00533 <span class="comment">// CDatagramSocketProxy</span>
<a name="l00534"></a>00534 <span class="comment">//------------------------------------------------------------------------------</span>
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 <span class="keyword">enum</span> UDPOperation {
<a name="l00537"></a>00537     UDP_OPERATION_NONE,
<a name="l00538"></a>00538     UDP_OPERATION_RECV_FROM,
<a name="l00539"></a>00539     UDP_OPERATION_SEND_TO
<a name="l00540"></a>00540 };
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PROXY_UDP_OVERHEAD_IPV4      = 10;
<a name="l00543"></a>00543 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PROXY_UDP_OVERHEAD_DOMAIN_NAME   = 262;
<a name="l00544"></a>00544 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PROXY_UDP_OVERHEAD_IPV6      = 20;
<a name="l00545"></a>00545 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PROXY_UDP_MAXIMUM_OVERHEAD       = PROXY_UDP_OVERHEAD_DOMAIN_NAME;
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="classCDatagramSocketProxy.html">00547</a> <span class="keyword">class </span><a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a> : <span class="keyword">public</span> wxDatagramSocket
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549 <span class="keyword">public</span>:
<a name="l00550"></a>00550     <span class="comment">/* Constructor */</span>
<a name="l00551"></a>00551     <a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a>(
<a name="l00552"></a>00552         wxIPaddress &amp;address,
<a name="l00553"></a>00553         wxSocketFlags flags = wxSOCKET_NONE,
<a name="l00554"></a>00554         <span class="keyword">const</span> <a class="code" href="classCProxyData.html" title="The ProxyData class will hold information about the proxy server to be used.">CProxyData</a> *proxyData = NULL);
<a name="l00555"></a>00555     
<a name="l00556"></a>00556     <span class="comment">/* Destructor */</span>
<a name="l00557"></a>00557     ~<a class="code" href="classCDatagramSocketProxy.html">CDatagramSocketProxy</a>();
<a name="l00558"></a>00558     
<a name="l00559"></a>00559     <span class="comment">/* Interface */</span>
<a name="l00560"></a>00560     <span class="keywordtype">void</span> SetUDPSocketOk() { m_udpSocketOk = <span class="keyword">true</span>; }
<a name="l00561"></a>00561     
<a name="l00562"></a>00562     <span class="comment">/* wxDatagramSocket Interface */</span>
<a name="l00563"></a>00563     <span class="keyword">virtual</span> wxDatagramSocket&amp; RecvFrom(
<a name="l00564"></a>00564         wxSockAddress&amp; addr, <span class="keywordtype">void</span>* buf, wxUint32 nBytes );
<a name="l00565"></a>00565     <span class="keyword">virtual</span> wxDatagramSocket&amp; SendTo(
<a name="l00566"></a>00566         wxIPaddress&amp; addr, <span class="keyword">const</span> <span class="keywordtype">void</span>* buf, wxUint32 nBytes );
<a name="l00567"></a>00567     <span class="keyword">virtual</span> wxUint32 LastCount(<span class="keywordtype">void</span>) <span class="keyword">const</span>;
<a name="l00568"></a>00568     
<a name="l00569"></a>00569 <span class="keyword">private</span>:
<a name="l00570"></a>00570     <span class="keywordtype">bool</span>            m_udpSocketOk;
<a name="l00571"></a>00571     <a class="code" href="classCProxySocket.html">CProxySocket</a>        m_proxyTCPSocket;
<a name="l00572"></a>00572     <span class="keyword">enum</span> UDPOperation   m_lastUDPOperation;
<a name="l00573"></a>00573     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_lastUDPOverhead;
<a name="l00574"></a>00574     wxMutex         m_socketLocker;
<a name="l00575"></a>00575 };
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="comment">/******************************************************************************/</span>
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 <span class="preprocessor">#endif </span><span class="comment">/* __PROXY_H__ */</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="comment">// File_checked_for_headers</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 4 Dec 2014 for aMule by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
